<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¥­éš¨æ©Ÿåˆ†çµ„å·¥å…· - ç²¾ç°¡ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ SheetJS ç”¨æ–¼è§£æ Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }

        .group-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        #fileInput { display: none; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-5xl mx-auto">
        <!-- æ¨™é¡Œå€ -->
        <div class="text-center mb-10">
            <h1 class="text-4xl font-bold text-slate-800 mb-2">ğŸ‘¥ éš¨æ©Ÿåˆ†çµ„å°å¹«æ‰‹</h1>
            <p class="text-slate-500">æ”¯æ´ Excel åŒ¯å…¥ï¼Œåš´æ ¼äººæ•¸ä¸Šé™æ¨¡å¼</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- å·¦å´ï¼šè¼¸å…¥å€åŸŸ -->
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-slate-700">
                            1. è¼¸å…¥åå–®
                        </label>
                        <button 
                            onclick="document.getElementById('fileInput').click()" 
                            class="text-xs bg-emerald-50 text-emerald-600 border border-emerald-200 px-2 py-1 rounded hover:bg-emerald-100 transition-colors flex items-center"
                        >
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            åŒ¯å…¥ Excel
                        </button>
                        <input type="file" id="fileInput" accept=".xlsx, .xls, .csv">
                    </div>
                    
                    <textarea 
                        id="nameInput" 
                        class="w-full h-64 p-4 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all custom-scrollbar text-slate-600"
                        placeholder="è«‹è¼¸å…¥åå­—...&#10;æˆ–æ˜¯é»æ“Šä¸Šæ–¹æŒ‰éˆ•åŒ¯å…¥ Excel"
                    ></textarea>
                    <div id="countDisplay" class="mt-2 text-xs text-slate-400 text-right">å·²è¼¸å…¥ 0 äºº</div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">
                        2. æ¯çµ„äººæ•¸ä¸Šé™
                    </label>
                    <div class="flex items-center space-x-4">
                        <input 
                            type="number" 
                            id="groupSize" 
                            value="3" 
                            min="1" 
                            class="w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition-all text-center font-bold text-slate-700"
                        >
                        <span class="text-slate-500 whitespace-nowrap">äºº / çµ„</span>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-2">* æ¯çµ„äººæ•¸çµ•ä¸è¶…éæ­¤æ•¸å€¼ï¼Œå¤šå‡ºçš„äººå°‡è‡ªæˆä¸€çµ„</p>
                </div>

                <button 
                    onclick="generateGroups()"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl shadow-lg shadow-blue-200 transition-all transform active:scale-95 flex items-center justify-center space-x-2"
                >
                    <span>ğŸ² é–‹å§‹éš¨æ©Ÿåˆ†çµ„</span>
                </button>
            </div>

            <!-- å³å´ï¼šçµæœå±•ç¤ºå€åŸŸ -->
            <div class="lg:col-span-2">
                <div id="resultContainer" class="bg-slate-100 p-6 rounded-3xl min-h-[500px] border-2 border-dashed border-slate-300 relative">
                    <!-- åˆå§‹æç¤º -->
                    <div id="emptyState" class="absolute inset-0 flex flex-col items-center justify-center text-slate-400 text-center px-4">
                        <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <p class="text-lg">åœ¨å·¦å´è¼¸å…¥åå–®æˆ–åŒ¯å…¥ Excel<br>ä¸¦è¨­å®šæ¯çµ„æœ€é«˜äººæ•¸</p>
                    </div>

                    <div id="groupGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- å‹•æ…‹ç”Ÿæˆçµ„åˆ¥ -->
                    </div>
                </div>

                <!-- åº•éƒ¨æ“ä½œæŒ‰éˆ• -->
                <div id="actionButtons" class="hidden mt-6 flex justify-end space-x-3">
                    <button onclick="copyToClipboard()" class="px-6 py-2 bg-white border border-slate-300 text-slate-600 rounded-lg hover:bg-slate-50 transition-all text-sm font-medium">
                        ğŸ“‹ è¤‡è£½çµæœ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- è¨Šæ¯å½ˆçª— -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 transition-opacity pointer-events-none z-50">
        è¨Šæ¯å…§å®¹
    </div>

    <script>
        const nameInput = document.getElementById('nameInput');
        const countDisplay = document.getElementById('countDisplay');
        const fileInput = document.getElementById('fileInput');

        function updateCount() {
            const names = nameInput.value.split('\n').map(n => n.trim()).filter(n => n !== '');
            countDisplay.innerText = `å·²è¼¸å…¥ ${names.length} äºº`;
        }

        nameInput.addEventListener('input', updateCount);

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (evt) => {
                try {
                    const data = evt.target.result;
                    const workbook = XLSX.read(data, { type: 'binary' });
                    let allNames = [];
                    workbook.SheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        json.forEach(row => {
                            row.forEach(cell => {
                                if (cell && cell.toString().trim() !== "") {
                                    allNames.push(cell.toString().trim());
                                }
                            });
                        });
                    });

                    if (allNames.length > 0) {
                        nameInput.value = allNames.join('\n');
                        updateCount();
                        showToast("Excel åŒ¯å…¥æˆåŠŸï¼");
                    }
                } catch (err) {
                    alert("æª”æ¡ˆè§£æå‡ºéŒ¯ï¼Œè«‹ç¢ºèªæª”æ¡ˆæ ¼å¼æ˜¯å¦æ­£ç¢ºã€‚");
                }
                fileInput.value = "";
            };
            reader.readAsBinaryString(file);
        });

        function generateGroups() {
            const rawNames = nameInput.value.split('\n').map(n => n.trim()).filter(n => n !== '');
            const maxSize = parseInt(document.getElementById('groupSize').value);

            if (rawNames.length === 0) {
                alert('è«‹å…ˆè¼¸å…¥åå–®æˆ–åŒ¯å…¥ Excel');
                return;
            }
            if (isNaN(maxSize) || maxSize < 1) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ¯çµ„äººæ•¸ä¸Šé™');
                return;
            }

            // éš¨æ©Ÿæ´—ç‰Œ
            let shuffled = [...rawNames];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }

            let groups = [];
            // åš´æ ¼æŒ‰ç…§ maxSize é€²è¡Œåˆ‡åˆ†
            for (let i = 0; i < shuffled.length; i += maxSize) {
                groups.push(shuffled.slice(i, i + maxSize));
            }

            render(groups);
        }

        function render(groups) {
            const grid = document.getElementById('groupGrid');
            const emptyState = document.getElementById('emptyState');
            const actionButtons = document.getElementById('actionButtons');
            
            emptyState.style.display = 'none';
            actionButtons.classList.remove('hidden');
            grid.innerHTML = '';

            groups.forEach((group, index) => {
                const card = document.createElement('div');
                card.className = 'group-card bg-white p-5 rounded-2xl shadow-sm border border-slate-200';
                card.style.animationDelay = `${index * 0.05}s`;
                
                const membersHtml = group.map(m => `
                    <div class="flex items-center space-x-2 py-1.5">
                        <span class="w-1.5 h-1.5 rounded-full bg-blue-400"></span>
                        <span class="text-slate-600 font-medium">${m}</span>
                    </div>
                `).join('');

                card.innerHTML = `
                    <div class="flex justify-between items-center mb-3 border-b border-slate-100 pb-2">
                        <h3 class="font-bold text-blue-600">ç¬¬ ${index + 1} çµ„</h3>
                        <span class="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded-md">${group.length} äºº</span>
                    </div>
                    <div class="space-y-1">
                        ${membersHtml}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 2000);
        }

        function copyToClipboard() {
            const cards = document.querySelectorAll('.group-card');
            let text = "--- éš¨æ©Ÿåˆ†çµ„çµæœ ---\n\n";
            cards.forEach((card, i) => {
                const title = card.querySelector('h3').innerText;
                const members = Array.from(card.querySelectorAll('.text-slate-600')).map(m => m.innerText).join('ã€');
                text += `${title}: ${members}\n`;
            });

            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showToast("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
        }
    </script>
</body>

</html>
